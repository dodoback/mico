
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë¯¸ì½”íŒ€ | ê³ ê°í›„ê¸°</title>
  <link rel="stylesheet" href="styles.css" />
  <script defer src="script.js"></script>
</head>

<body>
  <header class="site-header">
    <a href="index.html" class="logo">ë¯¸ì½”íŒ€</a>
    <!-- í–„ë²„ê±° ë²„íŠ¼ -->
    <input type="checkbox" id="menu-toggle" />
    <label for="menu-toggle" class="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </label>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav>
      <ul class="nav-links">
        <li><a href="lineup.html">ê¸°ì‚¬ ë¼ì¸ì—…</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">ê°€ê²©í‘œ</a>
          <ul class="dropdown-menu">
            <li><a href="price-delegation.html">ëŒ€ë¦¬ ê°€ê²©</a></li>
            <li><a href="price-duo.html">ë“€ì˜¤ ê°€ê²©</a></li>
            <li><a href="price-placement.html">ë°°ì¹˜ ê³ ì‚¬</a></li>
            <li><a href="price-coaching.html">1:1 ê°•ì˜</a></li>
            <li><a href="price-growth.html">ìœ¡ì„±</a></li>
            <li><a href="price-consulting.html">ê¸°íƒ€ì„œë¹„ìŠ¤</a></li>
          </ul>
        </li>
        <li><a href="certification.html">ì‘ì—…ì¸ì¦</a></li>
        <li><a href="progress.html">ì‘ì—…í˜„í™©</a></li>
        <li><a href="reviews.html">ê³ ê°í›„ê¸°</a></li>
        <li><a href="notice.html">ê³µì§€ì‚¬í•­</a></li>
      </ul>
    </nav>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const dropdownToggle = document.querySelector('.dropdown-toggle');
        const dropdown = dropdownToggle?.closest('.dropdown');
    
        dropdownToggle?.addEventListener('click', function (e) {
          e.preventDefault();
          dropdown?.classList.toggle('open');
        });
    
        document.addEventListener('click', function (e) {
          if (dropdown && !dropdown.contains(e.target)) {
            dropdown.classList.remove('open');
          }
        });
      });
    </script>
    
    <a href="#" class="contact-btn">
      <img src="img/icons8-ì¹´ì¹´ì˜¤-í†¡-48.png" alt=""> ì¹´í†¡ìƒë‹´
    </a>
  </header>


  <main class="review-section">
    <!-- í¬í†  í›„ê¸° -->
    <section class="photo-review">
      <h2>ğŸ“¸ í¬í†  í›„ê¸°</h2>
      <div class="slider-wrapper">
        <button class="slide-btn prev">â€¹</button>
        <div class="slider">
          <div class="slides">
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°1" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°2" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°3" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°4" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°5" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°6" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°7" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°8" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°9" />
            <img src="img/ìˆ™ë ¨ë„.webp" alt="í›„ê¸°10" />
          </div>
        </div>
        <button class="slide-btn next">â€º</button>
      </div>

    </section>

    <!-- ê¸€ í›„ê¸° ë¦¬ìŠ¤íŠ¸ -->
    <section class="text-review">
      <div class="review-header-bar">
        <h2>ğŸ“ ê¸€ í›„ê¸°</h2>
        <div>
          <input type="text" id="searchInput" placeholder="Search" class="review-search" />
          <button id="addReviewBtn">í›„ê¸° ì‘ì„±</button>
          <button id="adminLoginBtn">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
          <button id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
      <div class="review-box">
        <table class="review-table">
          <thead>
            <tr>
              <th>No</th>
              <th>ì œëª©</th>
              <th>ê¸€ì“´ì´</th>
              <th>ì‘ì„±ì‹œê°„</th>
              <th>ì¡°íšŒìˆ˜</th>
              <th class="admin-col">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="reviewList"></tbody>

         
        </table>
         <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ì„ í…Œì´ë¸” ë°–ìœ¼ë¡œ ì´ë™ -->
  <div class="pagination" id="pagination">
    <button class="prev" onclick="changePage('prev')">â€¹ ì´ì „</button>
  <div class="page-buttons"></div>
  <button class="next" onclick="changePage('next')">ë‹¤ìŒ â€º</button>
  </div>
      </div>
    </section>

    <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="detailModal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3 id="modalTitle"></h3>
        <p><strong>ì‘ì„±ì:</strong> <span id="modalAuthor"></span></p>
        <p><strong>ë‚´ìš©:</strong></p>
        <p id="modalContent"></p>
        <div class="rating">
          <strong>í‰ì :</strong>
          <div id="modalRating" class="stars"></div>
        </div>

        <div class="comment-section">
          <h4>ğŸ’¬ ëŒ“ê¸€</h4>
          <ul id="commentList"></ul>
          <input type="text" id="commentInput" placeholder="ëŒ“ê¸€ ì…ë ¥..." />
          <button id="addCommentBtn">ë“±ë¡</button>
        </div>
      </div>
    </div>

    <!-- í›„ê¸° ì‘ì„± ëª¨ë‹¬ -->
    <div class="modal" id="writeModal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3>í›„ê¸° ì‘ì„±</h3>
        <input type="text" id="newTitle" placeholder="ì œëª©" />
        <input type="text" id="newAuthor" placeholder="ì‘ì„±ì" />
        <textarea id="newContent" placeholder="í›„ê¸° ë‚´ìš©"></textarea>
        <div class="rating-input">
          <strong>í‰ì :</strong>
          <div id="starInput" class="stars-input">
            â˜…â˜…â˜…â˜…â˜…
          </div>
        </div>
        <button id="submitReview">ë“±ë¡</button>
      </div>
    </div>

   <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ -->
<div class="modal" id="adminModal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
    <input type="email" id="adminEmail" placeholder="ì´ë©”ì¼ ì…ë ¥" />
    <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
    <button id="loginBtn">ë¡œê·¸ì¸</button>
  </div>
</div>

  </main>



 <style>

 
    /* ===== ì „ì²´ í›„ê¸° ì˜ì—­ ===== */
    .review-section {
      padding: 60px 40px;
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Noto Sans KR', sans-serif;
    }

    /* ===== í¬í†  í›„ê¸° ===== */
    .photo-review h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      font-weight: 700;
      margin-top: 100px;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      overflow: hidden;
      position: relative;
    }

    .slider {
      overflow: hidden;
      flex: 1;
    }

    .slides {
      display: flex;
      transition: transform 0.5s ease;
    }

    .slides img {
      width: calc(100% / 5);
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
      margin-right: 10px;
    }

    /* ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ */
    .slide-btn {
      background-color: #333;
      color: #fff;
      border: none;
      font-size: 24px;
      padding: 10px 16px;
      cursor: pointer;
      border-radius: 8px;
      z-index: 1;
    }

    .slide-btn:hover {
      background-color: #444;
    }

    /* ===== ê¸€ í›„ê¸° ===== */
    .text-review {
      margin-top: 80px;
    }

    .text-review h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .review-box {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.05);
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .review-title {
      font-size: 1rem;
    }

    .review-search {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #444;
      background-color: #2a2a2a;
      color: #fff;
    }

    .review-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .review-table th,
    .review-table td {
      text-align: left;
      padding: 12px;
      border-bottom: 1px solid #333;
    }

    .review-table th {
      background: #2b2b2b;
      color: #ddd;
      font-weight: 600;
    }

    /* ===== ë°˜ì‘í˜• ===== */
    @media (max-width: 1024px) {
      .slides img {
        width: calc(100% / 3);
        height: 150px;
      }
    }

    @media (max-width: 768px) {
      .slides img {
        width: calc(100% / 2);
        height: 140px;
      }

      .slide-btn {
        font-size: 20px;
        padding: 8px 12px;
      }

      .review-section {
        padding: 40px 20px;
      }
    }

    .review-section {
      padding: 60px 40px;
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Noto Sans KR', sans-serif;
    }

    /* í¬í†  í›„ê¸° ìŠ¬ë¼ì´ë” */
    .photo-review h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      overflow: hidden;
    }

    .slider {
      flex: 1;
      overflow: hidden;
    }

    .slides {
      display: flex;
      transition: transform 0.5s ease;
    }

    .slides img {
      width: calc(100% / 5);
      height: 180px;
      object-fit: cover;
      margin-right: 10px;
      border-radius: 8px;
    }

    .slide-btn {
      background: #333;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    .slide-btn:hover {
      background: #444;
    }

    /* ê¸€ í›„ê¸° */
    .review-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 80px;
      margin-bottom: 10px;
    }

    .review-box {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
    }

    .review-search {
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #2a2a2a;
      color: white;
      margin-right: 10px;
    }

    .review-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    .review-table th,
    .review-table td {
      padding: 12px;
      border-bottom: 1px solid #333;
    }

    .review-table th {
      background: #2b2b2b;
      font-weight: bold;
    }

    .admin-col {
      display: none;
    }

    .admin-mode .admin-col {
      display: table-cell;
    }

    /* ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      color: white;
    }

    .modal-content input,
    textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #444;
      background: #2a2a2a;
      color: white;
    }

    .modal-content button {
      background: #6a5acd;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .close-btn {
      float: right;
      font-size: 20px;
      cursor: pointer;
    }

    /* ë³„ì  */
    .stars,
    .stars-input {
      font-size: 20px;
      color: #888;
      user-select: none;
    }

    .stars .filled,
    .stars-input span.selected {
      color: gold;
      cursor: pointer;
    }

    .rating-input {
      margin-top: 10px;
    }

    .comment-section {
      margin-top: 20px;
    }

    .comment-section ul {
      list-style: none;
      padding-left: 0;
      max-height: 150px;
      overflow-y: auto;
    }

    .comment-section li {
      background: #2a2a2a;
      margin: 5px 0;
      padding: 8px;
      border-radius: 6px;
      font-size: 14px;
    }

    .comment-section input {
      margin-top: 10px;
      width: 100%;
      padding: 8px;
      background: #2a2a2a;
      border: 1px solid #444;
      color: white;
      border-radius: 6px;
    }

    .comment-section button {
      margin-top: 8px;
      padding: 6px 12px;
      background: #6a5acd;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .pagination {
      margin-top: 20px;
      text-align: center;
    }

    .pagination button {
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      padding: 6px 12px;
      margin: 0 4px;
      border-radius: 6px;
      cursor: pointer;
    }

    .pagination button.active {
      background: #6a5acd;
      font-weight: bold;
    }

    .pagination button:hover {
      background: #4b4b9b;
    }

    .pagination {
  margin-top: 30px;
  text-align: center;
}

.pagination button {
  background: #2a2a2a;
  color: #fff;
  border: 1px solid #444;
  padding: 6px 12px;
  margin: 0 4px;
  border-radius: 6px;
  cursor: pointer;
  min-width: 60px;
}

.pagination button.active {
  background: #6a5acd;
  font-weight: bold;
}

.pagination button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.pagination button {
  background: #2a2a2a;
  color: #fff;
  border: 1px solid #444;
  padding: 6px 12px;
  margin: 0 4px;
  border-radius: 6px;
  cursor: pointer;
  min-width: 60px;
}

.pagination button.active {
  background: #6a5acd;
  font-weight: bold;
}

.pagination button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* ë³„ì  ì˜ì—­ ìŠ¤íƒ€ì¼ */
.stars-input span {
  font-size: 24px;
  color: #666; /* ê¸°ë³¸ íšŒìƒ‰ */
  cursor: pointer;
  transition: color 0.2s;
  margin-right: 4px;
}

.stars-input span.selected {
  color: gold !important; /* ë…¸ë€ìƒ‰ìœ¼ë¡œ í™•ì‹¤í•˜ê²Œ ì§€ì • */
}

#modalRating .star {
  font-size: 22px;
  color: #555;
}

#modalRating .star.filled {
  color: gold;
}

.pagination button {
  background: #2a2a2a;
  color: #fff;
  border: 1px solid #444;
  padding: 6px 12px;
  margin: 0 4px;
  border-radius: 6px;
  cursor: pointer;
  min-width: 60px;
}

.pagination button.active {
  background: #6a5acd;
  font-weight: bold;
}

.pagination button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}


</style>


<script>
 

 const renderPagination = (filteredLength = reviews.length) => {
  const totalPages = Math.ceil(filteredLength / reviewsPerPage);
  pagination.innerHTML = '';

  const prevBtn = document.createElement('button');
  prevBtn.textContent = 'â€¹ ì´ì „';
  prevBtn.disabled = currentPage === 1;
  prevBtn.onclick = () => {
    if (currentPage > 1) {
      currentPage--;
      renderReviews();
    }
  };
  pagination.appendChild(prevBtn);

  // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ ì¶”ê°€
  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    if (i === currentPage) btn.classList.add('active');
    btn.onclick = () => {
      currentPage = i;
      renderReviews();
    };
    pagination.appendChild(btn);
  }

  const nextBtn = document.createElement('button');
  nextBtn.textContent = 'ë‹¤ìŒ â€º';
  nextBtn.disabled = currentPage === totalPages;
  nextBtn.onclick = () => {
    if (currentPage < totalPages) {
      currentPage++;
      renderReviews();
    }
  };
  pagination.appendChild(nextBtn);
};


const renderReviews = () => {
  reviewList.innerHTML = '';
  
  const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
  const filtered = reviews.filter(r =>
    r.title.toLowerCase().includes(keyword) ||
    r.author.toLowerCase().includes(keyword) ||
    r.content.toLowerCase().includes(keyword)
  );
  
  const totalPages = Math.ceil(filtered.length / reviewsPerPage);
  const start = (currentPage - 1) * reviewsPerPage;
  const current = filtered.slice(start, start + reviewsPerPage);

  current.forEach((r, index) => {
    const row = document.createElement('tr');
    const no = (currentPage - 1) * reviewsPerPage + index + 1; // â† 1ë²ˆë¶€í„° ìˆœì°¨ ë²ˆí˜¸
    row.innerHTML = `
      <td>${no}</td> <!-- ì—¬ê¸° ë³€ê²½ -->
      <td class="review-title" style="cursor:pointer;color:#90c3f9;">${r.title}</td>
      <td>${r.author}</td>
      <td>${r.time}</td>
      <td>${r.views}</td>
      <td class="admin-col">
        ${isAdmin ? `<button data-fid="${r.fid}" class="delete-btn">ì‚­ì œ</button>` : ''}
      </td>
    `;
    row.querySelector('.review-title').onclick = () => openDetail(r);
    reviewList.appendChild(row);
  });

  document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.onclick = async () => {
      const fid = btn.getAttribute('data-fid');
      if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        await deleteDoc(doc(db, "reviews", fid));
        fetchReviews();
      }
    };
  });

  document.querySelector('.review-table').classList.toggle('admin-mode', isAdmin);
  renderPagination(filtered.length);
};


  const openDetail = (index) => {
    const r = reviews[index];
    selectedReviewIndex = index;
    r.views++;

    modalTitle.textContent = r.title;
    modalAuthor.textContent = r.author;
    modalContent.textContent = r.content;

    modalRating.innerHTML = '';
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.textContent = 'â˜…';
      star.classList.add('star');
      if (i <= r.rating) star.classList.add('filled');
      modalRating.appendChild(star);
    }

    renderComments();
    detailModal.style.display = 'flex';
    renderReviews();
  };

  const renderComments = () => {
  const r = reviews[selectedReviewIndex];
  commentList.innerHTML = '';

  r.comments.forEach((c, idx) => {
    const li = document.createElement('li');
    li.textContent = c;

    if (isAdmin) {
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'ì‚­ì œ';
      deleteBtn.style.marginLeft = '10px';
      deleteBtn.style.background = '#6a5acd';
      deleteBtn.style.color = 'white';
      deleteBtn.style.border = 'none';
      deleteBtn.style.padding = '2px 8px';
      deleteBtn.style.borderRadius = '4px';
      deleteBtn.style.cursor = 'pointer';
      deleteBtn.onclick = () => {
        if (confirm('ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          r.comments.splice(idx, 1);
          renderComments();
        }
      };
      li.appendChild(deleteBtn);
    }

    commentList.appendChild(li);
  });
};

  document.getElementById('addCommentBtn').onclick = () => {
    const comment = commentInput.value.trim();
    if (comment && selectedReviewIndex !== null) {
      reviews[selectedReviewIndex].comments.push(comment);
      commentInput.value = '';
      renderComments();
    }
  };

 

  const deleteReview = (index) => {
    if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      reviews.splice(index, 1);
      renderReviews();
    }
  };

  document.querySelectorAll('.close-btn').forEach(btn => {
    btn.onclick = () => btn.closest('.modal').style.display = 'none';
  });

  document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });
});


  document.getElementById('addReviewBtn').onclick = () => {
    document.getElementById('writeModal').style.display = 'flex';
  };

  document.getElementById('adminLoginBtn').onclick = () => {
    document.getElementById('adminModal').style.display = 'flex';
  };

  document.getElementById('loginBtn').onclick = async () => {
  const email = document.getElementById('adminEmail').value;
  const password = document.getElementById('adminPassword').value;

  try {
    await signInWithEmailAndPassword(auth, email, password); // âœ… ì‹¤ì œ ì¸ì¦
    isAdmin = true;
    fetchReviews();
    document.getElementById('adminModal').style.display = 'none';
    alert("ë¡œê·¸ì¸ ì„±ê³µ!");
  } catch (err) {
    alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + err.message);
  }
};



  // â­ ë³„ì  ì…ë ¥ UI
  const starInput = document.getElementById('starInput');
  starInput.innerHTML = '';
  for (let i = 1; i <= 5; i++) {
    const star = document.createElement('span');
    star.textContent = 'â˜…';
    star.onclick = () => {
      starInput.querySelectorAll('span').forEach((s, idx) => {
        s.classList.toggle('selected', idx < i);
      });
    };
    starInput.appendChild(star);
  }

  // â­ ê²€ìƒ‰ ì´ë²¤íŠ¸ ì—°ê²°
  document.getElementById('searchInput').addEventListener('input', () => {
    currentPage = 1;
    renderReviews();
  });

  // ìŠ¬ë¼ì´ë”
  const slides = document.querySelector('.slides');
  const slideImgs = slides.querySelectorAll('img');
  const prevBtn = document.querySelector('.slide-btn.prev');
  const nextBtn = document.querySelector('.slide-btn.next');
  let currentIndex = 0;

  const updateSlider = () => {
    const slideWidth = slideImgs[0].offsetWidth + 10;
    slides.style.transform = `translateX(-${slideWidth * currentIndex}px)`;
  };

  prevBtn.onclick = () => {
    if (currentIndex > 0) currentIndex--;
    updateSlider();
  };

  nextBtn.onclick = () => {
    if (currentIndex < slideImgs.length - 5) currentIndex++;
    updateSlider();
  };

  setInterval(() => {
    currentIndex = (currentIndex < slideImgs.length - 5) ? currentIndex + 1 : 0;
    updateSlider();
  }, 4000);

  renderReviews();
</script>







<script type="module">
document.getElementById('submitReview').onclick = async () => {
  const title = document.getElementById('newTitle').value.trim();
  const author = document.getElementById('newAuthor').value.trim();
  const content = document.getElementById('newContent').value.trim();
  const rating = document.querySelectorAll('#starInput span.selected').length;
  const time = new Date().toLocaleDateString();

  if (title && author && content) {
    try {
      await addDoc(colRef, {
        id: Date.now(),
        title,
        author,
        content,
        time,
        views: 0,
        rating,
        comments: []
      });

      // ì…ë ¥ í¼ ì´ˆê¸°í™”
      document.getElementById('newTitle').value = '';
      document.getElementById('newAuthor').value = '';
      document.getElementById('newContent').value = '';
      document.querySelectorAll('#starInput span').forEach(s => s.classList.remove('selected'));

      document.getElementById('writeModal').style.display = 'none';
      fetchReviews();
    } catch (error) {
      console.error("í›„ê¸° ë“±ë¡ ì‹¤íŒ¨:", error);
      alert("í›„ê¸° ë“±ë¡ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  } else {
    alert("ì œëª©, ì‘ì„±ì, ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
  }
};



  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    addDoc,
    deleteDoc,
    doc,
    updateDoc,
    query,
    orderBy
  } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBKrorhUNyv8q_Bekg5DJnkZgCW9kFfjjI",
    authDomain: "mico-test-3b006.firebaseapp.com",
    projectId: "mico-test-3b006",
    storageBucket: "mico-test-3b006.appspot.com",
    messagingSenderId: "282703834529",
    appId: "1:282703834529:web:31a65b83e1a351a3ba2fe0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const colRef = collection(db, "reviews");

  let isAdmin = false;
  let reviews = [];
  let currentPage = 1;
  const reviewsPerPage = 10;
  let selectedReviewIndex = null;

  const reviewList = document.getElementById('reviewList');
  const pagination = document.getElementById('pagination');
  const searchInput = document.getElementById('searchInput');
  const modal = document.getElementById('detailModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalAuthor = document.getElementById('modalAuthor');
  const modalContent = document.getElementById('modalContent');
  const modalRating = document.getElementById('modalRating');
  const commentList = document.getElementById('commentList');
  const commentInput = document.getElementById('commentInput');
  const addCommentBtn = document.getElementById('addCommentBtn');

  addCommentBtn.onclick = async () => {
    const comment = commentInput.value.trim();
    if (comment && selectedReviewIndex !== null) {
      const review = reviews[selectedReviewIndex];
      const fid = review.fid;
      const newComments = [...(review.comments || []), comment];

      try {
        await updateDoc(doc(db, "reviews", fid), {
          comments: newComments
        });
        commentInput.value = '';
        reviews[selectedReviewIndex].comments = newComments;
        renderComments();
      } catch (error) {
        console.error("ëŒ“ê¸€ ì €ì¥ ì‹¤íŒ¨:", error);
        alert("ëŒ“ê¸€ ì €ì¥ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }
  };

  function renderComments() {
    const r = reviews[selectedReviewIndex];
    commentList.innerHTML = '';

    (r.comments || []).forEach((c, idx) => {
      const li = document.createElement('li');
      li.textContent = c;

      if (isAdmin) {
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'ì‚­ì œ';
        deleteBtn.className = 'comment-delete';
        deleteBtn.onclick = async () => {
          const updated = [...r.comments];
          updated.splice(idx, 1);
          await updateDoc(doc(db, "reviews", r.fid), { comments: updated });
          reviews[selectedReviewIndex].comments = updated;
          renderComments();
        };
        li.appendChild(deleteBtn);
      }

      commentList.appendChild(li);
    });
  }

  function openDetail(review) {
    selectedReviewIndex = reviews.findIndex(r => r.fid === review.fid);
    review.views++;
    updateDoc(doc(db, "reviews", review.fid), { views: review.views });

    modalTitle.textContent = review.title;
    modalAuthor.textContent = review.author;
    modalContent.textContent = review.content;

    modalRating.innerHTML = '';
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.textContent = 'â˜…';
      star.classList.add('star');
      if (i <= review.rating) star.classList.add('filled');
      modalRating.appendChild(star);
    }

    renderComments();
    modal.style.display = 'flex';
  }

  function renderReviews() {
    reviewList.innerHTML = '';
    const keyword = searchInput.value.trim().toLowerCase();
    const filtered = reviews.filter(r =>
      r.title.toLowerCase().includes(keyword) ||
      r.author.toLowerCase().includes(keyword) ||
      r.content.toLowerCase().includes(keyword)
    );
    const start = (currentPage - 1) * reviewsPerPage;
    const current = filtered.slice(start, start + reviewsPerPage);

    current.forEach((r, index) => {
      const row = document.createElement('tr');
      const no = (currentPage - 1) * reviewsPerPage + index + 1;
      row.innerHTML = `
        <td>${no}</td>
        <td class="review-title" style="cursor:pointer;color:#90c3f9;">${r.title}</td>
        <td>${r.author}</td>
        <td>${r.time}</td>
        <td>${r.views}</td>
        <td class="admin-col">
          ${isAdmin ? `<button data-fid="${r.fid}" class="delete-btn">ì‚­ì œ</button>` : ''}
        </td>
      `;
      row.querySelector('.review-title').onclick = () => openDetail(r);
      reviewList.appendChild(row);
    });

    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.onclick = async () => {
        const fid = btn.getAttribute('data-fid');
        if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          await deleteDoc(doc(db, "reviews", fid));
          fetchReviews();
        }
      };
    });

    document.querySelector('.review-table').classList.toggle('admin-mode', isAdmin);
    renderPagination(filtered.length);
  }

  function renderPagination(total) {
    const totalPages = Math.ceil(total / reviewsPerPage);
    pagination.innerHTML = '';

    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'â€¹ ì´ì „';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
      if (currentPage > 1) {
        currentPage--;
        renderReviews();
      }
    };
    pagination.appendChild(prevBtn);

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      if (i === currentPage) btn.classList.add('active');
      btn.onclick = () => {
        currentPage = i;
        renderReviews();
      };
      pagination.appendChild(btn);
    }

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'ë‹¤ìŒ â€º';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderReviews();
      }
    };
    pagination.appendChild(nextBtn);
  }

  async function fetchReviews() {
    const q = query(colRef, orderBy("id", "desc"));
    const snapshot = await getDocs(q);
    reviews = snapshot.docs.map(doc => ({ fid: doc.id, ...doc.data() }));
    renderReviews();
  }

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const token = await user.getIdTokenResult();
      isAdmin = !!token.claims.admin;
      document.getElementById('logoutBtn').style.display = isAdmin ? 'block' : 'none';
    } else {
      isAdmin = false;
      document.getElementById('logoutBtn').style.display = 'none';
    }
    fetchReviews();
  });

  document.getElementById('loginBtn').onclick = async () => {
    const email = document.getElementById('adminEmail').value;
    const password = document.getElementById('adminPassword').value;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const token = await userCredential.user.getIdTokenResult();

      if (token.claims.admin) {
        isAdmin = true;
        document.getElementById('adminModal').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'block';
        alert("ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ!");
        fetchReviews();
      } else {
        alert("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
        await signOut(auth);
      }
    } catch (err) {
      alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + err.message);
    }
  };

  document.getElementById('logoutBtn')?.addEventListener('click', async () => {
    try {
      await signOut(auth);
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
      location.reload();
    } catch (err) {
      alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: " + err.message);
    }
  });

  window.onload = () => {
    fetchReviews();
  };



  
</script>


  


  
  <footer class="happyteam-footer">
    <div class="footer-content">
      <img src="img/í–„ìŠ¤í„°.webp" alt="ë¯¸ì½”íŒ€ ë¡œê³ " class="footer-logo">
      <h2>ë¯¸ì½”íŒ€ê³¼ í•¨ê»˜ ìµœê³ ì˜ í”Œë ˆì´ë¥¼ ê²½í—˜í•˜ì„¸ìš”!</h2>
      <p>ì‹¤ë ¥ í–¥ìƒë¶€í„° ë“ ë“ í•œ ë“€ì˜¤ê¹Œì§€, ë¯¸ì½”íŒ€ì´ ì—¬ëŸ¬ë¶„ê³¼ í•¨ê»˜í•©ë‹ˆë‹¤.</p>
      <div class="footer-links">
        <a href="#">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</a> |
        <a href="#">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a> |
        <a href="#">ë¬¸ì˜í•˜ê¸°</a>
      </div>
      <p class="copyright">Â© 2024 MICO. All rights reserved.</p>
    </div>
  </footer>
</body>

</html>